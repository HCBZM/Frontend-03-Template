<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container {
            width: 600px;
            font-size: 0;
            user-select: none;
        }
        .container .cell {
            display: inline-block;
            width: 5px;
            height: 5px;
            border-right: 1px solid #fff;
            border-bottom: 1px solid #fff;
            background-color: #999;
        }
        .container .fill {
            background-color: #222;
        }
    </style>
</head>
<body>
    <div class="container" id="container"></div>
    <button id="save">save</button>
    <script>
        const map = localStorage.getItem('map') && JSON.parse(localStorage.getItem('map')) || Array(100*100).fill(0);
        
        show()
        function show() {
            let container = document.getElementById('container');
            let fragment = document.createDocumentFragment();
            for (let i = 0; i < map.length; i ++) {
                let cell = document.createElement('div');
                cell.classList.add('cell');
                map[i] === 1 && cell.classList.add('fill');
                cell.setAttribute('key', i);
                fragment.appendChild(cell);
            }
            container.appendChild(fragment);
            // 注册事件
            drawEvent();
        }

        function drawEvent() {
            let mouseDown = false;
            let clear = false;
            let container = document.getElementById('container');

            // 画图事件
            container.addEventListener('mousedown', e => {
                mouseDown = true;
                if (e.button === 2) clear = true; 
            })
            container.addEventListener('contextmenu', e => e.preventDefault());
            container.addEventListener('mousemove', e => {
                if (!mouseDown) return;
                let target = e.target;
                let classList = target.classList;
                if (!classList.contains('cell')) return;
                let isFill = classList.contains('fill');
                let key = target.getAttribute('key');
                if (clear && isFill) {
                    classList.remove('fill');
                    map[key] = 0;
                }
                if (!clear && !isFill) {
                    classList.add('fill');
                    map[key] = 1;
                }
            })
            container.addEventListener('mouseup', () => {
                mouseDown = false;
                clear = false;
            });        

            // 保存地图
            let save = document.getElementById('save');
            save.addEventListener('click', e => {
                localStorage.setItem('map', JSON.stringify(map));
            })
        }


        let container = document.getElementById('container');
        let cells = Array.from(container.children);
        // 搜索路径
        // path(map, [5,5], [8,9]) path(map, [5,5], [8,9], true)
        async function path(map, start, end, a) {
            {
                let [x, y] = start;
                let point = x + y*100;
                cells[point].style.boxShadow = '0 0 2px 3px blue inset';
                [x, y] = end;
                point = x + y*100;
                cells[point].style.boxShadow = '0 0 2px 3px red inset';
            }

            let queue = [start];
            
            let insert = (x, y) => {
                let point = x + y*100;
                if (x < 0 || x > 99 || y < 0 || y > 99) return;
                if (map[point]) return;
                map[point] = 2;
                queue.push([x, y]);
            }

            while (true) {
                let x, y;
                if (a) {
                    [x, y] = queue.pop();
                } else {
                    [x, y] = queue.shift();
                }
                // console.log(x, y);
                viewPoint(x, y);
                await new Promise(res => setTimeout(res,10));
                if (x === end[0] && y === end[1]) return true;
                insert(x - 1, y);
                insert(x + 1, y);
                insert(x, y - 1);
                insert(x, y + 1);
            }    
        }

        
        function viewPoint(x, y) {
            let point = x + y*100;
            cells[point].style.backgroundColor = 'green';
        }
    </script>
</body>
</html>